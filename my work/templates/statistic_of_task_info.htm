<!!header>
<html>
	<head>
		<META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=windows-1251">
		<META HTTP-EQUIV="PRAGMA" CONTENT="NO-CACHE" />
		<META HTTP-EQUIV="CACHE-CONTROL" CONTENT="NO-CACHE" />
		<title>Statistic of task info</title>		
		<link rel="stylesheet" href="/proci/www/css/default.css" type="text/css">
        <script src="/proci/www/js/amcharts/amcharts.js" type="text/javascript"></script>
        <script src="/proci/www/js/amcharts/serial.js" type="text/javascript"></script>
		<SCRIPT type="text/javascript" SRC="/proci/www/js/form.js"></SCRIPT>
		
<!!bar_chart_start>		
		<script type="text/javascript">
		<!--
			var chart;

            var chartData = [
<!!bar_chart_data>
				//.toFixed(2) - Округление до 2ого знака после запятой
				{
                    "script":		"%script%",
<!!bar_chart_element>
					"%exit_code%":	%numbers%,

<!!bar_chart_element_end> 
				},

<!!bar_chart_data_end> 
            ];

<!!bar_chart_specification_start> 
            AmCharts.ready(function () {
                // SERIAL CHART
                chart = new AmCharts.AmSerialChart();
                chart.dataProvider = chartData;
                chart.categoryField = "script";
                chart.plotAreaBorderAlpha = 0.2;

                // AXES
                // category
                var categoryAxis = chart.categoryAxis;
                categoryAxis.gridAlpha = 0.1;
                categoryAxis.axisAlpha = 0;
                categoryAxis.gridPosition = "start";

                // value
                var valueAxis = new AmCharts.ValueAxis();
				valueAxis.stackType = "regular";
                valueAxis.title = "Number of processes";
				valueAxis.gridAlpha = 0.1;
                valueAxis.axisAlpha = 0;
                chart.addValueAxis(valueAxis);
				
<!!bar_chart_specification_gragh>
                // GRAPHS
                var graph = new AmCharts.AmGraph();
                graph.title = "%exit_code_title%";
                graph.labelText = "[[percents]]%";
                graph.valueField = "%exit_code_valueField%";
                graph.type = "column";
                graph.lineAlpha = 0;
                graph.fillAlphas = 1;
                graph.lineColor = "%color%";
                graph.balloonText = "<span style='color:#555555;'>[[category]]</span><br><span style='font-size:14px'>[[title]]:<b>[[value]]</b></span>";
                chart.addGraph(graph);

<!!bar_chart_specification_end>
                // LEGEND                  
                var legend = new AmCharts.AmLegend();
                legend.borderAlpha = 0.2;
                legend.horizontalGap = 10;
                chart.addLegend(legend);

                // WRITE
                chart.write("bar_chart");
            });
			-->
		</script>

<!!submit_init_start> 
		<script type="text/javascript">
		<!--
		
			function submit_form( form ) {
                form.submit();
			}
		
			function init(form) {

<!!submit_init_dar_chart_3D> 
				//Отрисовать 3х мерные граффики 
				chart.depth3D = 25;
				chart.angle = 30;
				chart.validateNow();

<!!submit_init_end> 
				setText( form.thread_numbers,	"%thread_numbers%"	);
				setText( form.task_name,"%task_name%" );
				setText( form.task_id,	'%task_id%'	);				
			}
		-->
		</script>

<!!google_chart_start> 		
		<script type='text/javascript' src='https://www.google.com/jsapi'></script>
		<script type="text/javascript" src="https://www.google.com/jsapi?autoload={'modules':[{'name':'visualization',
       'version':'1','packages':['timeline']}]}"></script>
		<script type='text/javascript'>
			<!--
			google.load('visualization', '1', {packages:['orgchart']});
			google.setOnLoadCallback(drawChart);
			function drawChart() {
<!!gragh_data> 
				var %gragh_data% = new google.visualization.DataTable();
				%gragh_data%.addColumn('string', 'process');
				%gragh_data%.addColumn('string', 'parent_process');
				%gragh_data%.addColumn('string', 'extra');
				%gragh_data%.addRows([
<!!gragh_element> 					
					['%process%', '%parent_process%', '%extra%'],
<!!gragh_element_end>
				]);
<!!gragh_draw>				
				var %gragh_chart% = new google.visualization.OrgChart(document.getElementById('%gragh%'));
				%gragh_chart%.draw(%gragh_data%, {allowHtml:true});

<!!timeline_data>					
				var %container%			= document.getElementById('%timeline%');
				var %timeline_chart%	= new google.visualization.Timeline(%container%);
				var %dataTable%			= new google.visualization.DataTable();
				%dataTable%.addColumn({ type: 'string',	id: 'Group'	});
				%dataTable%.addColumn({ type: 'string',	id: 'Name'	});
				%dataTable%.addColumn({ type: 'date',	id: 'Start'	});
				%dataTable%.addColumn({ type: 'date',	id: 'End'	});
				%dataTable%.addRows([
				
<!!timeline_element>
					[ 
						'%group%', 
						'%name%',
						new Date(%start%),  
						new Date(%end%),
					],
				
<!!timeline_element_end>
				]);

<!!timeline_options_start>
				var %options% = {
					backgroundColor: '#ffffd0',
					timeline: { 
						showRowLabels:		false,
						groupByRowLabel:	%groupByRowLabel%,
						colorByRowLabel:	false,
					},
					avoidOverlappingGridLines: false,
					
<!!timeline_options_color_start>
					colors: [
						
<!!timeline_options_color_set>						
						'%color%',
							
<!!timeline_options_color_end>
					],
				
<!!timeline_options_end>
				};

<!!timeline_draw>
				%timeline_chart%.draw(%dataTable%, %options%);
				
<!!google_chart_end>
				}
			-->
		</script>

<!!Body>
	</head>
	<body onload="init(document.forms.main)">
	<FORM name="main" action="%url%" target="_self" method=post>
		<input type="hidden" name="thread_numbers" />
		<input type="hidden" name="task_name" />
		<input type="hidden" name="task_id" />
		<TABLE BORDER=1 CELLPADDING=2 CELLSPACING=2 style="width: 100%">
			<TR class="tb_hd">
				<TD colspan="2" style="width: 100%">
					<br>
					<b>Статистика работы скриптов задания "%task_name%"</b>
					<br>
					<div id="bar_chart" style="width: 100%; height: 400px;" class="tb_hd" ></div>
					<br>
					<br>
					<div id="%timeline%" style="width: 100%; height: 100%;" ></div>
					<br><!---->
					<br>
					<div id='%gragh%'></div>
					<br>
				</TD>
			</TR>
			
<!!Body_empty_database>
	</head>
	<body>
	<FORM>
		<TABLE style="width: 100%; height: 100%">
			<TR class="tb_hd">
				<TD align="center">
					База данных пуста
				</TD>
			</TR>


<!!Body_select> 
			<TR class="tb_hd">
				<TD colspan="2" align="center" width="100%">
					Информация об ошибках
				</TD>
			</TR>
			<TR>
				<TD align="center" width="15%">
					Ошибочно
					<br>
					обработанные
					<br>
					комплекты:
				</TD>
				<TD style='width: 85%'>
					<select size="3" style='width: 100%' name="selected_option" class="select_proc"  onchange="submit_form( document.forms.main )">
						%error_list_options%
					</select>
				</TD>
			</TR>
			<TR>
				<TD align="center" width="15%">
					Kомплект:
				</TD>
				<TD align="left" width="85%">
					%file_name%
				</TD>
			</TR>
			<TR>
				<TD align="center" width="15%">
					Поток №:
				</TD>
				<TD align="left" width="85%">
					%thread_id%
				</TD>
			</TR>
			<TR>
				<TD align="center" width="15%">
					Обработчик:
				</TD>
				<TD align="left" width="85%">
					%station_name%
				</TD>
			</TR>
			<TR class="tb_hd">
				<TD colspan="2" style='width: 100%'>
					<br>
					<div id="%timeline%" style="width: 100%; height: 100%;" ></div>
					<br>
					<div id='%gragh%'></div>
					<br>
				</TD>
			</TR>

<!!END> 
		</TABLE>
	</FORM>
	</BODY>
</HTML>




